<%- include('../partials/_header') %>
<%- include('../partials/style') %>
    <body>
        <style>
            .chart-container {
                height: 400px; /* Set an equal height */
                display: flex;
                flex-direction: column;
            }
            
            .chart-container .card-body {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            
            .chart-container canvas {
                max-height: 300px; /* Ensure canvas doesn't exceed container height */
                height: 100%;      /* Fill available height */
                width: 100%;       /* Maintain responsiveness */
            }
            </style>
   <%- include('../partials/sidebar') %>
   <%- include('../partials/topbar') %>
   <div class="content p-4" id="main-content">
       <div class="container-fluid mt-5 pt-5">
        <div class="container d-flex justify-content-end ">

           <div id="salesReport" class="col-md-6 section-details active">
               <h2>Sales Report</h2>
               <p>Generate and view the sales report</p>
           </div>
                
                <div class="col-md-6" style="left: 3%; background-color: #6c757d; border-radius: 17px; padding: 20px;">
                    <!-- Filter Form -->
                    <form action="/admin/salesReport" method="GET">
                        <div class="row g-3">
                            <!-- Report Type Dropdown -->
                            <div class="col-md-6" style="left: 10%;">
                                <label for="reportType" class="form-label text-white">Report Type</label>
                                <select id="reportType" name="reportType" class="form-select" required>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="custom">Custom Date Range</option>
                                </select>
                            </div>
            
                            <!-- Custom Date Range -->
                            <div class="col-md-6" id="customDateRange" style="display: none;">
                                <label for="startDate" class="form-label text-white">Start Date</label>
                                <input type="date" id="startDate" name="startDate" class="form-control">
                                <label for="endDate" class="form-label text-white mt-2">End Date</label>
                                <input type="date" id="endDate" name="endDate" class="form-control">
                            </div>
            
                            <!-- Format Selector -->
                            <div class="col-md-6">
                                <label for="format" class="form-label text-white">Download Format</label><br>
                                <select id="format" name="format" class="form-select" required>
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                </select>
                            </div>
            
                            <!-- Submit Button -->
                            <div class="col-md-12 d-flex justify-content-center">
                                <button type="submit" class="btn btn-primary mt-3">Generate Report</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
               <br>
               <!-- Summary Section -->
               <div class="row mb-4">
                   
                   <div class="col-md-3">
                       <div class="card shadow-sm text-center h-100">
                           <div class="card-body">
                               <h5 class="card-title">Total Sales</h5>
                               <p class="card-text"><%= totalSales %></p>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-3">
                       <div class="card shadow-sm text-center h-100">
                           <div class="card-body">
                               <h5 class="card-title">Total order Amount</h5>
                               <p class="card-text">₹<%= totalSalesAmount %></p>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-3">
                       <div class="card shadow-sm text-center h-100">
                           <div class="card-body">
                               <h5 class="card-title">Most Ordered Product</h5>
                               <p class="card-text">    <%= mostOrderedProduct %></p>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-3">
                       <div class="card shadow-sm text-center h-100">
                           <div class="card-body">
                               <h5 class="card-title">Total Discount Amount</h5>
                               <p class="card-text">₹<%= totalDiscountAmount %></p>
                           </div>
                       </div>
                   </div>
               </div>
   
               <!-- Graph Section -->
               <div class="row mt-4">
                   <div class="col-md-6">
                       <div class="card shadow-sm mb-4 chart-container">
                           <div class="card-body">
                               <h5 class="card-title">Sales</h5>
                               <canvas id="salesChart"></canvas>
                           </div>
                       </div>
                   </div>
                   <div class="col-md-6">
                       <div class="card shadow-sm mb-4 chart-container">
                           <div class="card-body">
                               <h5 class="card-title">Orders</h5>
                               <canvas id="ordersChart"></canvas>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>
   </div>

   
   
    
                <!-- Summary Section -->
                <!-- <div class="mt-4">
                    <h3>Sales Summary</h3> -->
                    <!-- <div>
                        <p><strong>Total Sales Count:</strong> <%= salesReport.salesCount %></p>
                        <p><strong>Total Sales Amount:</strong> ₹<%= (salesReport.totalOrderAmount - salesReport.totalDiscount).toFixed(2) %></p>
                    </div> -->
                <!-- </div> -->
    
                <!-- Sales Table
                <div class="table-responsive">
                    <% if (salesReport) { %>
                        <table class="table table-striped mt-4">
                            <thead>
                                <tr>
                                    <th>Sales Count</th>
                                    <th>Order Amount</th>
                                    <th>Discount Deducted</th>
                                    <th>Total Sales</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= salesReport.salesCount %></td>
                                    <td>₹<%= salesReport.totalOrderAmount.toFixed(2) %></td>
                                    <td>₹<%= salesReport.totalDiscount.toFixed(2) %></td>
                                    <td>₹<%= (salesReport.totalOrderAmount - salesReport.totalDiscount).toFixed(2) %></td>
                                </tr>
                            </tbody>
                        </table>
                    <% } else { %>
                        <h3>No sales data found for the selected period</h3>
                    <% } %>
                </div> -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <script>
        const reportTypeSelect = document.getElementById("reportType");
    const customDateRangeDiv = document.getElementById("customDateRange");

    // Event listener for dropdown change
    reportTypeSelect.addEventListener("change", function () {
        if (this.value === "custom") {
            customDateRangeDiv.style.display = "block";
        } else {
            customDateRangeDiv.style.display = "none";
        }
    });

        const ctxSales = document.getElementById('salesChart').getContext('2d');
        const salesChart = new Chart(ctxSales, {
            type: 'line',
            data: {
                labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                datasets: [{
                    label: 'Sales',
                    data: [65, 59, 80, 81, 56, 55, 40],
                    backgroundColor: 'rgba(255, 255, 255, 0.2)',
                    borderColor: 'rgba(255, 255, 255, 1)',
                    borderWidth: 2,
                    fill: true,
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: 'white' //  y-axis text color
                        }
                    },
                    x: {
                        ticks: {
                            color: 'white' //  x-axis text color
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'white' // legend text color
                        }
                    }
                }
            }
        });
        const ctxOrders = document.getElementById('ordersChart').getContext('2d');
        const ordersChart = new Chart(ctxOrders, {
            type: 'doughnut',
            data: {
                labels: ['Delivered', 'Pending', 'Cancelled'],
                datasets: [{
                    label: 'Orders',
                    data: [10, 5, 2],
                    backgroundColor: ['#4caf50', '#ff9800', '#f44336'],
                }]
            },
            options: {
                plugins: {
                    legend: {
                        labels: {
                            color: 'white' 
                        }
                    }
                }
            }
        });
    </script>
</body>